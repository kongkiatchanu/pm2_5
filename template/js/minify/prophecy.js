var osmUrl="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",osmAttrib='Map data Â© <a href="https://openstreetmap.org">OpenStreetMap</a> contributors',opacity=1,OpenStreetMap=new L.tileLayer(osmUrl,{maxZoom:18,attribution:osmAttrib,opacity:opacity}),Topographic=new L.esri.basemapLayer("Topographic",{opacity:opacity}),Streets=new L.esri.basemapLayer("Streets",{opacity:opacity}),NationalGeographic=new L.esri.basemapLayer("NationalGeographic",{opacity:opacity}),Oceans=new L.esri.basemapLayer("Oceans",{opacity:opacity}),Gray=new L.esri.basemapLayer("Gray",{opacity:opacity}),DarkGray=new L.esri.basemapLayer("DarkGray"),Imagery=new L.esri.basemapLayer("Imagery"),ShadedRelief=new L.esri.basemapLayer("ShadedRelief",{opacity:opacity});$("#pills-tab").hide(),$("#pills-tab2").hide();var config={DataFormat:"th",DataLang:"th",DataHotspotType:"MODIS",pm_region:"",pm_top:"All",curentStation:{},station_point:null,location:{lat:null,lon:null,dis:"All"},province_sel:null,province_all:[],pmLocations:{},rsForecast:{},rsProphecy:{},rsProphecy_region:""};function getBG(t,o){var e="";if(t)return"th"==o?t<=15?e='style="background-color: rgb(0,191,243)"':t>15&&t<=25?e='style="background-color: rgb(0,166,81)"':t>25&&t<=37?e='style="background-color: rgb(253,192,78)"':t>37&&t<=75?e='style="background-color: rgb(242,101,34)"':t>75&&t<=999&&(e='style="background-color: rgb(205,0,0)"'):t<=12?e='style="background-color: rgb(0, 153, 107)"':t>12&&t<=35?e='style="background-color: rgb(253,192,78)"':t>35&&t<=55?e='style="background-color: rgb(235, 132, 63)"':t>55&&t<=150?e='style="background-color: rgb(205,0,0)"':t>150&&t<=250?e='style="background-color: rgb(129, 21, 185)"':t>250&&(e='style="background-color: rgb(160, 7, 54)"'),e}function getBG2(t){return t<=15?txt="background-color: rgb(0,191,243)":t>15&&t<=25?txt="background-color: rgb(0,166,81)":t>25&&t<=37?txt="background-color: rgb(253,192,78)":t>37&&t<=75?txt="background-color: rgb(242,101,34)":t>75&&t<=999&&(txt="background-color: rgb(205,0,0)"),txt}function createProphecy(t){for(let p=0;p<config.rsProphecy.length;p++){var o=config.rsProphecy[p].zone_id;if(t){if(o==t){$(".forecast-title"+o).html(config.rsProphecy[p].zone_name_th);var e="";if(config.rsProphecy[p].provinces.length)for(let t=0;t<config.rsProphecy[p].provinces.length;t++)if(config.rsProphecy[p].provinces[t].stations.length)for(let o=0;o<config.rsProphecy[p].provinces[t].stations.length;o++){var r=config.rsProphecy[p].provinces[t].stations[o].pm25.PM25,a=null,n=null,i=null;if((s=config.rsProphecy[p].provinces[t].stations[o].weather).length)for(index_forecast=0;index_forecast<s.length;index_forecast++){var c=s[index_forecast].ForecastDate.split("T");$("#today_add").val()==c[0]&&(a=s[index_forecast].PM25),$("#today_add2").val()==c[0]&&(n=s[index_forecast].PM25),$("#today_add3").val()==c[0]&&(i=s[index_forecast].PM25)}e+="<tr>",e+="<td>"+config.rsProphecy[p].provinces[t].stations[o].location_name+"</td>",e+="<td>"+config.rsProphecy[p].provinces[t].province_name_th+"</td>",e+='<td class="text-center"><div class="pm-bage" '+getBG(r,config.DataFormat)+">"+r+"</div></td>",e+='<td class="text-center"><div class="pm-bage" '+getBG(a,config.DataFormat)+">"+a+"</div></td>",e+='<td class="text-center"><div class="pm-bage" '+getBG(n,config.DataFormat)+">"+n+"</div></td>",e+='<td class="text-center"><div class="pm-bage" '+getBG(i,config.DataFormat)+">"+i+"</div></td>",e+="</tr>"}$("#tblProphecy"+o+" tbody").html(e),$("#box_"+o).show()}}else{$(".forecast-title"+o).html(config.rsProphecy[p].zone_name_th);e="";if(config.rsProphecy[p].provinces.length)for(let t=0;t<config.rsProphecy[p].provinces.length;t++)if(config.rsProphecy[p].provinces[t].stations.length)for(let o=0;o<config.rsProphecy[p].provinces[t].stations.length;o++){var s;r=config.rsProphecy[p].provinces[t].stations[o].pm25.PM25,a=null,n=null,i=null;if((s=config.rsProphecy[p].provinces[t].stations[o].weather).length)for(index_forecast=0;index_forecast<s.length;index_forecast++){c=s[index_forecast].ForecastDate.split("T");$("#today_add").val()==c[0]&&(a=s[index_forecast].PM25),$("#today_add2").val()==c[0]&&(n=s[index_forecast].PM25),$("#today_add3").val()==c[0]&&(i=s[index_forecast].PM25)}e+="<tr>",e+="<td>"+config.rsProphecy[p].provinces[t].stations[o].location_name+"</td>",e+="<td>"+config.rsProphecy[p].provinces[t].province_name_th+"</td>",e+='<td class="text-center"><div class="pm-bage" '+getBG(r,config.DataFormat)+">"+r+"</div></td>",e+='<td class="text-center"><div class="pm-bage" '+getBG(a,config.DataFormat)+">"+a+"</div></td>",e+='<td class="text-center"><div class="pm-bage" '+getBG(n,config.DataFormat)+">"+n+"</div></td>",e+='<td class="text-center"><div class="pm-bage" '+getBG(i,config.DataFormat)+">"+i+"</div></td>",e+="</tr>"}$("#tblProphecy"+o+" tbody").html(e),$("#box_"+o).show()}}$(".table").DataTable({bDestroy:!0}),$(".loader").hide(),createMap(t)}function createMap(t){var o=[];o[1]=[18.7828996,98.9933469],o[2]=[15.7670029,100.5126912],o[3]=[16.44161,103.537464],o[4]=[14.74601483,98.62522061],o[5]=[12.614961,102.113984],o[6]=[7.4046537,99.51923],o[7]=[19.0198515,102.2896127];for(let g=0;g<config.rsProphecy.length;g++){var e=config.rsProphecy[g].zone_id;if(t){if(e==t){var r=new L.map("mapForecast"+t,{center:o[t],zoom:6,attributionControl:!1,maxZoom:7,minZoom:5});if(L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(r),config.rsProphecy[g].provinces.length)for(let t=0;t<config.rsProphecy[g].provinces.length;t++)if(config.rsProphecy[g].provinces[t].stations.length)for(let o=0;o<config.rsProphecy[g].provinces[t].stations.length;o++){let e=config.rsProphecy[g].provinces[t].stations[o],a=L.marker([e.location_lat,e.location_lon],{icon:L.divIcon({className:"my-custom-icon",iconSize:[35,35],html:'<div class="signoutz-marker" style="'+getBG2(e.pm25.PM25)+'">'+e.pm25.PM25+"</div>"})});e.pm25.PM25>0&&a.addTo(r)}}}else{var a=new L.map("mapForecast1",{center:o[1],zoom:6,attributionControl:!1,maxZoom:7,minZoom:5});L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(a);var n=new L.map("mapForecast2",{center:o[2],zoom:6,attributionControl:!1,maxZoom:7,minZoom:5});L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(n);var i=new L.map("mapForecast3",{center:o[3],zoom:6,attributionControl:!1,maxZoom:7,minZoom:5});L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(i);var c=new L.map("mapForecast4",{center:o[4],zoom:6,attributionControl:!1,maxZoom:7,minZoom:5});L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(c);var s=new L.map("mapForecast5",{center:o[5],zoom:7,attributionControl:!1,maxZoom:7,minZoom:5});L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(s);var p=new L.map("mapForecast6",{center:o[6],zoom:6,attributionControl:!1,maxZoom:7,minZoom:5});L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(p);var l=new L.map("mapForecast7",{center:o[7],zoom:6,attributionControl:!1,maxZoom:7,minZoom:5,attributionControl:!1});L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(l);for(let t=0;t<config.rsProphecy.length;t++){e=config.rsProphecy[t].zone_id;if(config.rsProphecy[t].provinces.length)for(let o=0;o<config.rsProphecy[t].provinces.length;o++)if(config.rsProphecy[t].provinces[o].stations.length)for(let r=0;r<config.rsProphecy[t].provinces[o].stations.length;r++){let g=config.rsProphecy[t].provinces[o].stations[r],m=L.marker([g.location_lat,g.location_lon],{icon:L.divIcon({className:"my-custom-icon",iconSize:[35,35],html:'<div class="signoutz-marker" style="'+getBG2(g.pm25.PM25)+'">'+g.pm25.PM25+"</div>"})});g.pm25.PM25>0&&(1==e&&m.addTo(a),2==e&&m.addTo(n),3==e&&m.addTo(i),4==e&&m.addTo(c),5==e&&m.addTo(s),6==e&&m.addTo(p),7==e&&m.addTo(l))}}}}}$(document).ready((function(){$("#pills-tab .nav-link").on("click",(function(){$("#pills-tab .nav-link").removeClass("active"),$(this).addClass("active"),config.DataFormat=$(this).attr("dformat"),"prophecy"==pathname.substring(0,8)&&config.rsProphecy&&createProphecy(config.rsProphecy_region)}));if(getUrlParameter("region")){config.pm_region=getUrlParameter("region");var t=[];t.north=1,t.central=2,t.northeast=3,t.western=4,t.eastern=5,t.south=6,t.other=7,config.rsProphecy_region=t[config.pm_region]}$.getJSON("https://www-old.cmuccdc.org/api2/dustboy/regionreport",(function(t){config.rsProphecy=t,config.rsProphecy&&createProphecy(config.rsProphecy_region)})),$(".blurinator").click((function(){var t=$(this).attr("mapid");html2canvas(document.getElementById("mapForecast"+t),{useCORS:!0,logging:!0}).then((function(o){var e=o.toDataURL();$.ajax({type:"POST",url:"https://pm2_5.nrct.go.th/main/createMapImage",data:{mapid:t,photo:e}}).done((function(o){if(console.log(o),o){var e="/prophecy_export/"+t;window.open(e,"_blank")}}))}))}))}));var getUrlParameter=function(t){var o,e,r=window.location.search.substring(1).split("&");for(e=0;e<r.length;e++)if((o=r[e].split("="))[0]===t)return void 0===typeof o[1]||decodeURIComponent(o[1]);return!1};